<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Connect - HIT Marketplace</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/qrcode@1.5.1/build/qrcode.min.js"></script>
    
</head>
<body>
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Navigation -->
        <nav class="hit-primary-bg border-gray-200 px-4 lg:px-6 py-3">
            <div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl">
                <a href="#" class="flex items-center" @click="showPage('home')">
                    <span class="self-center text-xl font-semibold whitespace-nowrap text-white">Campus Connect</span>
                </a>
                <div class="flex items-center lg:order-2">
                    <!-- Notification Icon for Logged in users -->
                    <div v-if="isLoggedIn" class="mr-3 relative">
                        <button @click="showPage('messages')" class="text-white hover:text-hit-secondary p-2 relative">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                            </svg>
                            <span v-if="unreadMessages > 0" class="notification-badge">{{ unreadMessages }}</span>
                        </button>
                    </div>
                    
                    <!-- Profile Icon for Logged in users -->
                    <div v-if="isLoggedIn" class="mr-3">
                        <button @click="showPage('profile')" class="flex items-center text-white hover:text-hit-secondary">
                            <div v-if="user && user.profilePic" class="w-8 h-8 rounded-full overflow-hidden mr-1">
                                <img :src="user.profilePic" alt="Profile" class="w-full h-full object-cover">
                            </div>
                            <div v-else class="user-avatar mr-1" :style="{backgroundColor: getRandomColor(user.name || '')}">
                                {{ getInitials(user.name || '') }}
                            </div>
                            <span class="hidden md:inline-block">{{ user.name }}</span>
                        </button>
                    </div>
                    
                    <!-- Auth buttons -->
                    <button v-if="!isLoggedIn" @click="showPage('login')" class="text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-4 lg:px-5 py-2 lg:py-2.5 mr-2 focus:outline-none">
                        Log in
                    </button>
                    <button v-if="isLoggedIn" @click="logout" class="text-white hover:bg-red-700 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-4 lg:px-5 py-2 lg:py-2.5 mr-2 focus:outline-none bg-red-600">
                        Log out
                    </button>
                    <button v-if="isLoggedIn" @click="showPage('new-listing')" class="text-white bg-hit-secondary hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-sm px-4 lg:px-5 py-2 lg:py-2.5 mr-2 focus:outline-none text-gray-900">
                        + New Listing
                    </button>
                    
                    <!-- Admin link if user is admin -->
                    <button v-if="isLoggedIn && isAdmin" @click="showPage('admin')" class="text-white bg-purple-600 hover:bg-purple-700 focus:ring-4 focus:ring-purple-300 font-medium rounded-lg text-sm px-4 lg:px-5 py-2 lg:py-2.5 mr-2 focus:outline-none">
                        Admin
                    </button>
                    
                    <button @click="toggleMobileMenu" class="inline-flex items-center p-2 ml-1 text-sm text-white rounded-lg lg:hidden hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-gray-200">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        <svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
                <div :class="{'hidden': !mobileMenuOpen}" class="justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2">
                    <ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0">
                        <li>
                            <a @click="showPage('home')" href="#" class="block py-2 pr-4 pl-3 text-white rounded bg-primary-700 lg:bg-transparent lg:p-0" aria-current="page">Home</a>
                        </li>
                        <li>
                            <a @click="showPage('home'); filterByCategory('Textbooks')" href="#" class="block py-2 pr-4 pl-3 text-white border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-primary-700 lg:p-0">Textbooks</a>
                        </li>
                        <li>
                            <a @click="showPage('home'); filterByCategory('Electronics')" href="#" class="block py-2 pr-4 pl-3 text-white border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-primary-700 lg:p-0">Electronics</a>
                        </li>
                        <li>
                            <a @click="showPage('home'); filterByCategory('Services')" href="#" class="block py-2 pr-4 pl-3 text-white border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-primary-700 lg:p-0">Services</a>
                        </li>
                        <li>
                            <a @click="showPage('home'); filterByCategory('Other')" href="#" class="block py-2 pr-4 pl-3 text-white border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-primary-700 lg:p-0">Other</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow">
            <!-- Home Page (Listings) -->
            <div v-if="currentPage === 'home'" class="container mx-auto px-4 py-8">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold mb-4 md:mb-0">HIT Campus Marketplace</h1>
                    <div class="w-full md:w-1/3">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                                </svg>
                            </div>
                            <input type="search" v-model="searchQuery" @input="searchListings" class="block w-full p-4 pl-10 text-sm form-input-dark border border-dark rounded-lg" placeholder="Search listings...">
                        </div>
                    </div>
                </div>

                <div v-if="isLoggedIn" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <div v-for="(listing, index) in filteredListings" :key="index" class="border border-dark rounded-lg overflow-hidden shadow-lg card-dark listing-transition">
                        <div v-if="listing.images && listing.images.length > 0" class="h-48 bg-gray-300 relative">
                            <img :src="listing.images[0]" class="h-full w-full object-cover" />
                            <div v-if="listing.status === 'pending'" class="absolute top-2 right-2 bg-amber-500 text-white rounded-full px-3 py-1 text-xs">
                                Pending Approval
                            </div>
                        </div>
                        <div v-else class="h-48 bg-gray-300 relative">
                            <div class="absolute h-full w-full flex items-center justify-center" :style="{ backgroundColor: getRandomColor(listing.title) }">
                                <span class="text-3xl text-white">{{ getInitials(listing.title) }}</span>
                            </div>
                            <div v-if="listing.status === 'pending'" class="absolute top-2 right-2 bg-amber-500 text-white rounded-full px-3 py-1 text-xs">
                                Pending Approval
                            </div>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-start">
                                <h3 class="text-lg font-bold mb-1">{{ listing.title }}</h3>
                                <span class="text-sm font-semibold hit-secondary-text">${{ listing.price }}</span>
                            </div>
                            <span class="inline-block px-2 py-1 text-xs rounded-full mb-2" :class="getCategoryClass(listing.category)">
                                {{ listing.category }}
                            </span>
                            <p class="text-sm mb-2">{{ truncateDescription(listing.description) }}</p>
                            <div class="flex justify-between items-center mt-3">
                                <div class="flex items-center">
                                    <div v-if="listing.sellerProfilePic" class="w-6 h-6 rounded-full overflow-hidden mr-2">
                                        <img :src="listing.sellerProfilePic" alt="Seller" class="w-full h-full object-cover">
                                    </div>
                                    <div v-else class="user-avatar w-6 h-6 text-xs mr-2" :style="{backgroundColor: getRandomColor(listing.sellerName)}">
                                        {{ getInitials(listing.sellerName) }}
                                    </div>
                                    <span class="text-xs opacity-75">{{ listing.sellerName }}</span>
                                </div>
                                <button @click="contactSeller(listing)" class="text-sm px-3 py-1 rounded bg-primary-color text-white hover:bg-opacity-90 transition">Contact</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-else class="p-6 border border-dark rounded-lg card-dark text-center">
                    <h2 class="text-xl font-bold mb-4">Login Required</h2>
                    <p class="mb-4">Please log in to view and interact with the HIT Campus Connect marketplace.</p>
                    <div class="login-required mt-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div v-for="i in 6" :key="i" class="border border-dark rounded-lg overflow-hidden shadow-lg card-dark">
                                <div class="h-48 bg-gray-300"></div>
                                <div class="p-4">
                                    <div class="h-6 bg-gray-300 rounded mb-2 w-3/4"></div>
                                    <div class="h-4 bg-gray-300 rounded mb-2 w-1/4"></div>
                                    <div class="h-4 bg-gray-300 rounded mb-2"></div>
                                    <div class="h-4 bg-gray-300 rounded mb-2 w-5/6"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button @click="showPage('login')" class="mt-6 px-6 py-2 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition">
                        Login Now
                    </button>
                </div>
            </div>

            <!-- Login Page -->
            <div v-if="currentPage === 'login'" class="container mx-auto px-4 py-8 flex justify-center">
                <div class="w-full max-w-md p-6 auth-form rounded-lg shadow-md border">
                    <h2 class="text-2xl font-bold mb-6 text-center">Campus Connect Login</h2>
                    <p class="mb-6 text-center">For Harare Institute of Technology Students & Lecturers</p>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Email Address</label>
                        <input type="email" v-model="loginForm.email" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="name@hit.ac.zw" required>
                        <p v-if="loginForm.emailError" class="mt-1 text-sm text-red-600">{{ loginForm.emailError }}</p>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block mb-2 text-sm font-medium">Password</label>
                        <input type="password" v-model="loginForm.password" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="••••••••" required>
                        <p v-if="loginForm.passwordError" class="mt-1 text-sm text-red-600">{{ loginForm.passwordError }}</p>
                    </div>
                    
                    <div class="flex items-start mb-6">
                        <div class="flex items-center h-5">
                            <input id="remember" type="checkbox" v-model="loginForm.remember" class="w-4 h-4 rounded">
                        </div>
                        <label for="remember" class="ml-2 text-sm font-medium">Remember me</label>
                    </div>
                    
                    <button @click="login" class="w-full text-white bg-primary-color hover:bg-opacity-90 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-base px-5 py-2.5 text-center">
                        Sign in
                    </button>
                    
                    <div class="text-sm mt-4 text-center">
                        <span>Don't have an account? </span>
                        <a @click="showPage('register')" href="#" class="hit-primary-text hover:underline">Register</a>
                    </div>
                </div>
            </div>

            <!-- Register Page -->
            <div v-if="currentPage === 'register'" class="container mx-auto px-4 py-8 flex justify-center">
                <div class="w-full max-w-md p-6 auth-form rounded-lg shadow-md border">
                    <h2 class="text-2xl font-bold mb-6 text-center">Register for Campus Connect</h2>
                    <p class="mb-6 text-center">Create your HIT marketplace account</p>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Full Name</label>
                        <input type="text" v-model="registerForm.name" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="Maka Tida" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Email Address</label>
                        <input type="email" v-model="registerForm.email" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="regID@hit.ac.zw" required>
                        <p v-if="registerForm.emailError" class="mt-1 text-sm text-red-600">{{ registerForm.emailError }}</p>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">User Type</label>
                        <select v-model="registerForm.userType" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" required>
                            <option value="student">Student</option>
                            <option value="lecturer">Lecturer</option>
                            <!--<option value="service_provider">Service Provider</option>-->
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Password</label>
                        <input type="password" v-model="registerForm.password" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="••••••••" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block mb-2 text-sm font-medium">Confirm Password</label>
                        <input type="password" v-model="registerForm.confirmPassword" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="••••••••" required>
                        <p v-if="registerForm.passwordError" class="mt-1 text-sm text-red-600">{{ registerForm.passwordError }}</p>
                    </div>
                    
                    <button @click="register" class="w-full text-white bg-primary-color hover:bg-opacity-90 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-base px-5 py-2.5 text-center">
                        Create Account
                    </button>
                    
                    <div class="text-sm mt-4 text-center">
                        <span>Already have an account? </span>
                        <a @click="showPage('login')" href="#" class="hit-primary-text hover:underline">Sign in</a>
                    </div>
                </div>
            </div>

            <!-- Two-Factor Authentication Setup Page -->
            <div v-if="currentPage === 'mfa-setup'" class="container mx-auto px-4 py-8 flex justify-center">
                <div class="w-full max-w-md p-6 auth-form rounded-lg shadow-md border">
                    <h2 class="text-2xl font-bold mb-4 text-center">Set Up Two-Factor Authentication</h2>
                    <p class="mb-6 text-center">Secure your account by enabling 2FA</p>
                    
                    <div class="mb-6 text-center">
                        <div v-if="mfaQrCode" class="flex justify-center mb-4">
                            <div id="qrcode"></div>
                        </div>
                        <p class="mb-4">Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)</p>
                        <p class="mb-4 p-2 bg-gray-100 dark:bg-gray-800 rounded">
                            <strong>Secret key:</strong> {{ mfaSecret }}
                        </p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            If you can't scan the QR code, you can manually enter the secret key above into your authenticator app.
                        </p>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block mb-2 text-sm font-medium">Enter Verification Code</label>
                        <div class="verification-code-input">
                            <input type="text" v-for="(digit, index) in mfaCodeDigits" :key="index" 
                                v-model="mfaCodeDigits[index]" 
                                maxlength="1"
                                class="form-input-dark border border-dark text-base"
                                @keyup="handleMfaDigitInput($event, index)"
                                @paste="handleMfaPaste"
                                ref="mfaDigitInputs">
                        </div>
                        <p v-if="mfaSetupError" class="mt-2 text-sm text-red-600 text-center">{{ mfaSetupError }}</p>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button @click="skipMfaSetup" class="w-1/2 px-5 py-2.5 text-base font-medium rounded-lg border border-gray-300 dark:border-gray-600">
                            Skip for Now
                        </button>
                        <button @click="verifyAndEnableMfa" class="w-1/2 text-white bg-primary-color hover:bg-opacity-90 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-base px-5 py-2.5 text-center">
                            Verify & Enable
                        </button>
                    </div>
                </div>
            </div>

            <!-- MFA Verification Modal -->
            <div v-if="showMfaVerification" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="text-xl font-bold">Two-Factor Authentication</h2>
                        <button class="close-btn" @click="showMfaVerification = false">&times;</button>
                    </div>
                    <p class="mb-4">Please enter the verification code from your authenticator app.</p>
                    
                    <div class="mb-6">
                        <div class="verification-code-input">
                            <input type="text" v-for="(digit, index) in mfaVerificationDigits" :key="index" 
                                v-model="mfaVerificationDigits[index]" 
                                maxlength="1"
                                class="form-input-dark border border-dark text-base"
                                @keyup="handleMfaVerificationDigitInput($event, index)"
                                @paste="handleMfaVerificationPaste"
                                ref="mfaVerificationInputs">
                        </div>
                        <p v-if="mfaVerificationError" class="mt-2 text-sm text-red-600 text-center">{{ mfaVerificationError }}</p>
                    </div>
                    
                    <button @click="verifyMfaLogin" class="w-full text-white bg-primary-color hover:bg-opacity-90 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-base px-5 py-2.5 text-center">
                        Verify
                    </button>
                </div>
            </div>
            
            <!-- New Listing Page -->
            <div v-if="currentPage === 'new-listing'" class="container mx-auto px-4 py-8 flex justify-center">
                <div class="w-full max-w-2xl p-6 auth-form rounded-lg shadow-md border">
                    <h2 class="text-2xl font-bold mb-6">Create New Listing</h2>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Title</label>
                        <input type="text" v-model="newListing.title" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="Electronics textbook - 3rd Edition" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Category</label>
                        <select v-model="newListing.category" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" required>
                            <option value="Textbooks">Textbooks</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Services">Services</option>
                            <option value="Accommodation">Accommodation</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Price (USD)</label>
                        <input type="number" v-model="newListing.price" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="30" required min="0" step="0.01">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Description</label>
                        <textarea v-model="newListing.description" rows="4" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="Provide details about your item or service..." required></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Contact Information</label>
                        <input type="text" v-model="newListing.contact" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="Phone number or email" required>
                    </div>
                    
                    <!-- Image Upload Section -->
                    <div class="mb-6">
                        <label class="block mb-2 text-sm font-medium">Upload Images</label>
                        <div class="flex items-center justify-center w-full">
                            <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer border-dark">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <svg class="w-8 h-8 mb-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                    </svg>
                                    <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                                        <span class="font-semibold">Click to upload</span>
                                    </p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        PNG, JPG or JPEG (MAX. 5MB)
                                    </p>
                                </div>
                                <input type="file" class="hidden" accept="image/png, image/jpeg, image/jpg" @change="handleImageUpload" multiple>
                            </label>
                        </div>
                        <div v-if="newListing.images && newListing.images.length > 0" class="product-image-gallery mt-4">
                            <div v-for="(image, idx) in newListing.images" :key="idx" class="relative">
                                <img :src="image" class="product-image-item" />
                                <button @click="removeImage(idx)" class="absolute top-1 right-1 bg-red-600 rounded-full p-1 text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button @click="showPage('home')" class="px-5 py-2.5 text-base font-medium rounded-lg border border-dark">
                            Cancel
                        </button>
                        <button @click="createListing" class="px-5 py-2.5 text-base font-medium rounded-lg text-white bg-primary-color hover:bg-opacity-90">
                            Post Listing
                        </button>
                    </div>
                </div>
            </div>

            <!-- User Profile Page -->
            <div v-if="currentPage === 'profile'" class="container mx-auto px-4 py-8">
                <div class="w-full max-w-4xl mx-auto">
                    <!-- Profile Header -->
                    <div class="mb-8 p-6 auth-form rounded-lg shadow-md border profile-card">
                        <div class="flex flex-col md:flex-row items-center md:items-start">
                            <div class="mb-4 md:mb-0 md:mr-6 flex-shrink-0">
                                <div v-if="user && user.profilePic" class="w-24 h-24 rounded-full overflow-hidden">
                                    <img :src="user.profilePic" alt="Profile" class="w-full h-full object-cover">
                                </div>
                                <div v-else class="user-avatar w-24 h-24 text-2xl" :style="{backgroundColor: getRandomColor(user.name || '')}">
                                    {{ getInitials(user.name || '') }}
                                </div>
                                <div class="mt-2 text-center">
                                    <label class="cursor-pointer text-primary-color hover:underline text-sm">
                                        <span>Change Photo</span>
                                        <input type="file" class="hidden" accept="image/png, image/jpeg, image/jpg" @change="handleProfilePicUpload">
                                    </label>
                                </div>
                            </div>
                            <div class="flex-grow text-center md:text-left">
                                <h1 class="text-2xl font-bold mb-2">{{ user.name }}</h1>
                                <p class="text-gray-600 dark:text-gray-400 mb-2">{{ user.email }}</p>
                                <p class="text-sm mb-2">
                                    <span class="inline-block px-2 py-1 text-xs rounded-full" :class="getUserTypeClass(user.userType)">
                                        {{ formatUserType(user.userType) }}
                                    </span>
                                </p>
                                <div class="mt-4">
                                    <p class="text-sm">{{ user.bio || 'No bio available' }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 pt-6 border-t border-dark">
                            <button @click="showEditProfileModal = true" class="text-sm px-4 py-2 rounded bg-primary-color text-white hover:bg-opacity-90 transition">
                                Edit Profile
                            </button>
                            <button v-if="!user.mfaEnabled" @click="setupMfa" class="text-sm px-4 py-2 ml-2 rounded bg-purple-600 text-white hover:bg-opacity-90 transition">
                                Enable 2FA
                            </button>
                            <button v-else class="text-sm px-4 py-2 ml-2 rounded bg-gray-500 text-white cursor-not-allowed">
                                2FA Enabled
                            </button>
                        </div>
                    </div>
                
                    <!-- Profile Content Tabs -->
                    <div class="profile-tabs border-dark">
                        <div @click="profileTab = 'listings'" class="profile-tab" :class="profileTab === 'listings' ? 'tab-active' : 'tab-inactive'">
                            My Listings
                        </div>
                        <div @click="profileTab = 'saved'" class="profile-tab" :class="profileTab === 'saved' ? 'tab-active' : 'tab-inactive'">
                            Saved Items
                        </div>
                        <div @click="profileTab = 'messages'" class="profile-tab" :class="profileTab === 'messages' ? 'tab-active' : 'tab-inactive'">
                            Messages
                        </div>
                    </div>
                
                    <!-- My Listings Tab -->
                    <div v-if="profileTab === 'listings'">
                        <div v-if="userListings.length === 0" class="p-6 auth-form rounded-lg shadow-md border text-center mt-4">
                            <p>You haven't created any listings yet.</p>
                            <button @click="showPage('new-listing')" class="mt-4 px-4 py-2 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition">
                                Create New Listing
                            </button>
                        </div>
                        <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
                            <div v-for="(listing, index) in userListings" :key="index" class="border border-dark rounded-lg overflow-hidden shadow-lg card-dark listing-transition">
                                <div v-if="listing.images && listing.images.length > 0" class="h-48 bg-gray-300 relative">
                                    <img :src="listing.images[0]" class="h-full w-full object-cover" />
                                    <div v-if="listing.status === 'pending'" class="absolute top-2 right-2 bg-amber-500 text-white rounded-full px-3 py-1 text-xs">
                                        Pending Approval
                                    </div>
                                </div>
                                <div v-else class="h-48 bg-gray-300 relative">
                                    <div class="absolute h-full w-full flex items-center justify-center" :style="{ backgroundColor: getRandomColor(listing.title) }">
                                        <span class="text-3xl text-white">{{ getInitials(listing.title) }}</span>
                                    </div>
                                    <div v-if="listing.status === 'pending'" class="absolute top-2 right-2 bg-amber-500 text-white rounded-full px-3 py-1 text-xs">
                                        Pending Approval
                                    </div>
                                </div>
                                <div class="p-4">
                                    <div class="flex justify-between items-start">
                                        <h3 class="text-lg font-bold mb-1">{{ listing.title }}</h3>
                                        <span class="text-sm font-semibold hit-secondary-text">${{ listing.price }}</span>
                                    </div>
                                    <span class="inline-block px-2 py-1 text-xs rounded-full mb-2" :class="getCategoryClass(listing.category)">
                                        {{ listing.category }}
                                    </span>
                                    <p class="text-sm mb-2">{{ truncateDescription(listing.description) }}</p>
                                    <div class="flex justify-between items-center mt-3">
                                        <div class="text-xs opacity-75">
                                            {{ new Date(listing.createdAt).toLocaleDateString() }}
                                        </div>
                                        <div class="flex space-x-2">
                                            <button @click="editListing(listing)" class="text-sm px-2 py-1 rounded bg-blue-500 text-white hover:bg-opacity-90 transition">
                                                Edit
                                            </button>
                                            <button @click="deleteListing(listing.id)" class="text-sm px-2 py-1 rounded bg-red-500 text-white hover:bg-opacity-90 transition">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Saved Items Tab -->
                    <div v-if="profileTab === 'saved'">
                        <div v-if="savedListings.length === 0" class="p-6 auth-form rounded-lg shadow-md border text-center mt-4">
                            <p>You don't have any saved items yet.</p>
                            <button @click="showPage('home')" class="mt-4 px-4 py-2 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition">
                                Browse Listings
                            </button>
                        </div>
                        <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
                            <!-- Saved listings will appear here -->
                        </div>
                    </div>
                
                    <!-- Messages Tab -->
                    <div v-if="profileTab === 'messages'">
                        <div v-if="chatList.length === 0" class="p-6 auth-form rounded-lg shadow-md border text-center mt-4">
                            <p>You don't have any messages yet.</p>
                        </div>
                        <div v-else class="auth-form rounded-lg shadow-md border mt-4">
                            <div class="p-4 border-b border-dark">
                                <h3 class="text-lg font-bold">Recent Conversations</h3>
                            </div>
                            <div class="divide-y divide-dark">
                                <div v-for="(chat, index) in chatList" :key="index" 
                                    @click="openChat(chat)" 
                                    class="p-4 flex items-center hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer">
                                    <div v-if="chat.profilePic" class="w-10 h-10 rounded-full overflow-hidden mr-3">
                                        <img :src="chat.profilePic" alt="Contact" class="w-full h-full object-cover">
                                    </div>
                                    <div v-else class="user-avatar w-10 h-10 mr-3" :style="{backgroundColor: getRandomColor(chat.name)}">
                                        {{ getInitials(chat.name) }}
                                    </div>
                                    <div class="flex-grow">
                                        <div class="flex justify-between">
                                            <h4 class="font-medium">{{ chat.name }}</h4>
                                            <span class="text-xs text-gray-500 dark:text-gray-400">
                                                {{ formatChatTime(chat.lastMessageTime) }}
                                            </span>
                                        </div>
                                        <p class="text-sm truncate" :class="{'font-semibold': chat.unread}">
                                            {{ chat.lastMessage }}
                                        </p>
                                    </div>
                                    <div v-if="chat.unread" class="w-3 h-3 bg-primary-color rounded-full ml-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages/Chat Page -->
            <div v-if="currentPage === 'messages'" class="container mx-auto px-4 py-8">
                <div class="md:flex max-w-5xl mx-auto">
                    <!-- Chat List Sidebar -->
                    <div class="md:w-1/3 md:pr-4 mb-4 md:mb-0">
                        <div class="auth-form rounded-lg shadow-md border h-full">
                            <div class="p-4 border-b border-dark">
                                <h3 class="text-lg font-bold">Conversations</h3>
                            </div>
                            <div v-if="chatList.length === 0" class="p-4 text-center text-gray-500">
                                <p>No conversations yet</p>
                            </div>
                            <div v-else class="divide-y divide-dark max-h-[500px] overflow-y-auto">
                                <div v-for="(chat, index) in chatList" :key="index" 
                                    @click="openChat(chat)" 
                                    :class="{'bg-gray-100 dark:bg-gray-800': activeChatId === chat.id}"
                                    class="p-4 flex items-center hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer">
                                    <div v-if="chat.profilePic" class="w-10 h-10 rounded-full overflow-hidden mr-3">
                                        <img :src="chat.profilePic" alt="Contact" class="w-full h-full object-cover">
                                    </div>
                                    <div v-else class="user-avatar w-10 h-10 mr-3" :style="{backgroundColor: getRandomColor(chat.name)}">
                                        {{ getInitials(chat.name) }}
                                    </div>
                                    <div class="flex-grow">
                                        <div class="flex justify-between">
                                            <h4 class="font-medium">{{ chat.name }}</h4>
                                            <span class="text-xs text-gray-500 dark:text-gray-400">
                                                {{ formatChatTime(chat.lastMessageTime) }}
                                            </span>
                                        </div>
                                        <p class="text-sm truncate" :class="{'font-semibold': chat.unread}">
                                            {{ chat.lastMessage }}
                                        </p>
                                    </div>
                                    <div v-if="chat.unread" class="w-3 h-3 bg-primary-color rounded-full ml-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Window -->
                    <div class="md:w-2/3 auth-form rounded-lg shadow-md border flex flex-col">
                        <div v-if="!activeChat" class="flex-grow flex items-center justify-center p-8 text-gray-500">
                            <div class="text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                </svg>
                                <h3 class="text-xl font-medium mb-2">Your Messages</h3>
                                <p>Select a conversation to start chatting</p>
                            </div>
                        </div>
                        
                        <div v-else class="flex flex-col h-full">
                            <!-- Chat Header -->
                            <div class="p-4 border-b border-dark flex items-center">
                                <div v-if="activeChat.profilePic" class="w-10 h-10 rounded-full overflow-hidden mr-3">
                                    <img :src="activeChat.profilePic" alt="Contact" class="w-full h-full object-cover">
                                </div>
                                <div v-else class="user-avatar w-10 h-10 mr-3" :style="{backgroundColor: getRandomColor(activeChat.name)}">
                                    {{ getInitials(activeChat.name) }}
                                </div>
                                <div>
                                    <h4 class="font-medium">{{ activeChat.name }}</h4>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        {{ activeChat.isOnline ? 'Online' : 'Offline' }}
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Chat Messages -->
                            <div class="flex-grow p-4 overflow-y-auto chat-container" ref="chatContainer">
                                <div v-for="(message, index) in activeChat.messages" :key="index"
                                    :class="[
                                        'p-3 mb-3 max-w-xs',
                                        message.senderId === user.id ? 'chat-message-mine' : 'chat-message-other'
                                    ]">
                                    <p>{{ message.content }}</p>
                                    <p class="text-xs text-right mt-1 opacity-70">
                                        {{ formatMessageTime(message.timestamp) }}
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Message Input -->
                            <div class="p-4 border-t border-dark">
                                <div class="flex">
                                    <input 
                                        type="text" 
                                        v-model="newMessage" 
                                        @keyup.enter="sendMessage"
                                        class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" 
                                        placeholder="Type a message..." 
                                    />
                                    <button 
                                        @click="sendMessage" 
                                        class="ml-2 px-4 bg-primary-color text-white rounded-lg hover:bg-opacity-90">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Page -->
            <div v-if="currentPage === 'admin'" class="container mx-auto px-4 py-8">
                <div class="md:flex">
                    <!-- Admin Sidebar -->
                    <div class="md:w-64 mb-4 md:mb-0 admin-sidebar p-4 rounded-lg">
                        <h2 class="text-lg font-bold mb-4">Admin Panel</h2>
                        <ul>
                            <li class="mb-2">
                                <button @click="adminTab = 'pending'" 
                                    class="w-full text-left p-2 rounded" 
                                    :class="adminTab === 'pending' ? 'bg-primary-color bg-opacity-20' : ''">
                                    Pending Listings
                                </button>
                            </li>
                            <li class="mb-2">
                                <button @click="adminTab = 'users'" 
                                    class="w-full text-left p-2 rounded" 
                                    :class="adminTab === 'users' ? 'bg-primary-color bg-opacity-20' : ''">
                                    User Management
                                </button>
                            </li>
                            <li>
                                <button @click="adminTab = 'settings'" 
                                    class="w-full text-left p-2 rounded" 
                                    :class="adminTab === 'settings' ? 'bg-primary-color bg-opacity-20' : ''">
                                    Settings
                                </button>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Admin Content -->
                    <div class="md:flex-1 md:ml-6">
                        <!-- Pending Listings Tab -->
                        <div v-if="adminTab === 'pending'" class="card-dark rounded-lg shadow-md border p-4">
                            <h2 class="text-xl font-bold mb-4">Pending Listings</h2>
                            
                            <div v-if="pendingListings.length === 0" class="text-center p-8 border border-dashed border-dark rounded-lg">
                                <p>No pending listings to approve</p>
                            </div>
                            
                            <div v-else>
                                <div v-for="(listing, index) in pendingListings" :key="index" class="border border-dark rounded-lg overflow-hidden shadow-md mb-4">
                                    <div class="md:flex">
                                        <div class="md:w-1/4 h-48 bg-gray-300 relative">
                                            <div v-if="listing.images && listing.images.length > 0">
                                                <img :src="listing.images[0]" class="h-full w-full object-cover" />
                                            </div>
                                            <div v-else class="absolute h-full w-full flex items-center justify-center" :style="{ backgroundColor: getRandomColor(listing.title) }">
                                                <span class="text-3xl text-white">{{ getInitials(listing.title) }}</span>
                                            </div>
                                        </div>
                                        <div class="p-4 md:flex-1">
                                            <div class="flex justify-between items-start">
                                                <h3 class="text-lg font-bold">{{ listing.title }}</h3>
                                                <span class="text-sm font-semibold hit-secondary-text">${{ listing.price }}</span>
                                            </div>
                                            <div class="mb-2">
                                                <span class="inline-block px-2 py-1 text-xs rounded-full" :class="getCategoryClass(listing.category)">
                                                    {{ listing.category }}
                                                </span>
                                                <span class="inline-block px-2 py-1 text-xs rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-300 ml-2">
                                                    Pending
                                                </span>
                                            </div>
                                            <p class="text-sm mb-4">{{ listing.description }}</p>
                                            <div class="flex items-center mb-4">
                                                <div v-if="listing.sellerProfilePic" class="w-6 h-6 rounded-full overflow-hidden mr-2">
                                                    <img :src="listing.sellerProfilePic" alt="Seller" class="w-full h-full object-cover">
                                                </div>
                                                <div v-else class="user-avatar w-6 h-6 text-xs mr-2" :style="{backgroundColor: getRandomColor(listing.sellerName)}">
                                                    {{ getInitials(listing.sellerName) }}
                                                </div>
                                                <span class="text-sm opacity-75">{{ listing.sellerName }}</span>
                                                <span class="text-xs text-gray-500 dark:text-gray-400 ml-4">
                                                    Submitted: {{ formatDate(listing.createdAt) }}
                                                </span>
                                            </div>
                                            <div class="flex space-x-3">
                                                <button @click="approveListing(listing.id)" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-opacity-90 transition">
                                                    Approve
                                                </button>
                                                <button @click="rejectListing(listing.id)" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-opacity-90 transition">
                                                    Reject
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- User Management Tab -->
                        <div v-if="adminTab === 'users'" class="card-dark rounded-lg shadow-md border p-4">
                            <h2 class="text-xl font-bold mb-4">User Management</h2>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-dark">
                                    <thead>
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">User</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Email</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Type</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-dark">
                                        <tr v-for="(user, index) in allUsers" :key="index">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div v-if="user.profilePic" class="w-8 h-8 rounded-full overflow-hidden mr-3">
                                                        <img :src="user.profilePic" alt="User" class="w-full h-full object-cover">
                                                    </div>
                                                    <div v-else class="user-avatar w-8 h-8 mr-3" :style="{backgroundColor: getRandomColor(user.name)}">
                                                        {{ getInitials(user.name) }}
                                                    </div>
                                                    <div>
                                                        <div class="font-medium">{{ user.name }}</div>
                                                        <div v-if="user.isAdmin" class="text-xs text-purple-600 dark:text-purple-400">Admin</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                {{ user.email }}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs rounded-full" :class="getUserTypeClass(user.userType)">
                                                    {{ formatUserType(user.userType) }}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs rounded-full"
                                                    :class="user.isActive ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300' : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300'">
                                                    {{ user.isActive ? 'Active' : 'Inactive' }}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex space-x-2">
                                                    <button @click="toggleUserStatus(user.id)" class="px-2 py-1 text-xs rounded" :class="user.isActive ? 'bg-amber-500 text-white' : 'bg-green-500 text-white'">
                                                        {{ user.isActive ? 'Deactivate' : 'Activate' }}
                                                    </button>
                                                    <button v-if="!user.isAdmin" @click="makeAdmin(user.id)" class="px-2 py-1 text-xs rounded bg-purple-500 text-white">
                                                        Make Admin
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Settings Tab -->
                        <div v-if="adminTab === 'settings'" class="card-dark rounded-lg shadow-md border p-4">
                            <h2 class="text-xl font-bold mb-4">Admin Settings</h2>
                            
                            <div class="mb-6">
                                <h3 class="text-lg font-medium mb-2">Listing Categories</h3>
                                <div class="flex flex-wrap mb-2">
                                    <div v-for="(category, index) in adminSettings.categories" :key="index" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm m-1 flex items-center">
                                        {{ category }}
                                        <button @click="removeCategory(index)" class="ml-2 text-red-500">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex">
                                    <input type="text" v-model="newCategory" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="New category name">
                                    <button @click="addCategory" class="ml-2 px-4 py-2 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition">
                                        Add
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <h3 class="text-lg font-medium mb-2">System Preferences</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center">
                                        <input id="requireApproval" type="checkbox" v-model="adminSettings.requireListingApproval" class="w-4 h-4 rounded">
                                        <label for="requireApproval" class="ml-2">Require admin approval for new listings</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="requireMfa" type="checkbox" v-model="adminSettings.requireMfa" class="w-4 h-4 rounded">
                                        <label for="requireMfa" class="ml-2">Require two-factor authentication for all users</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                <button @click="saveAdminSettings" class="px-4 py-2 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition">
                                    Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Modal -->
            <div v-if="showContactModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="text-xl font-bold">Contact Seller</h3>
                        <button class="close-btn" @click="showContactModal = false">&times;</button>
                    </div>
                    <p class="mb-2"><span class="font-semibold">Item:</span> {{ selectedListing.title }}</p>
                    <p class="mb-2"><span class="font-semibold">Seller:</span> {{ selectedListing.sellerName }}</p>
                    <p class="mb-4"><span class="font-semibold">Contact:</span> {{ selectedListing.contact || selectedListing.sellerEmail }}</p>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Your Message</label>
                        <textarea v-model="contactMessage" rows="3" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="I'm interested in your listing..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button @click="showContactModal = false" class="px-4 py-2 text-sm font-medium rounded-lg border border-dark">
                            Close
                        </button>
                        <button @click="startConversation" class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-primary-color hover:bg-opacity-90">
                            Send Message
                        </button>
                    </div>
                </div>
            </div>

            <!-- Edit Profile Modal -->
            <div v-if="showEditProfileModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="text-xl font-bold">Edit Profile</h3>
                        <button class="close-btn" @click="showEditProfileModal = false">&times;</button>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Full Name</label>
                        <input type="text" v-model="editProfileForm.name" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="Your name">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Bio</label>
                        <textarea v-model="editProfileForm.bio" rows="3" class="form-input-dark border border-dark text-base rounded-lg block w-full p-2.5" placeholder="Tell others about yourself..."></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Profile Picture</label>
                        <div class="flex items-center">
                            <div v-if="editProfileForm.profilePic" class="w-16 h-16 rounded-full overflow-hidden mr-4">
                                <img :src="editProfileForm.profilePic" alt="Profile" class="w-full h-full object-cover">
                            </div>
                            <div v-else class="user-avatar w-16 h-16 mr-4">
                                {{ getInitials(editProfileForm.name) }}
                            </div>
                            <label class="cursor-pointer px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg">
                                <span>Change Photo</span>
                                <input type="file" class="hidden" accept="image/png, image/jpeg, image/jpg" @change="handleProfilePicUpload">
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button @click="showEditProfileModal = false" class="px-4 py-2 text-sm font-medium rounded-lg border border-dark">
                            Cancel
                        </button>
                        <button @click="updateUserProfile" class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-primary-color hover:bg-opacity-90">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="hit-primary-bg py-6 text-white">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <h3 class="text-lg font-bold">Campus Connect</h3>
                        <p class="text-sm">Exclusively for Harare Institute of Technology</p>
                    </div>
                    <div class="text-sm text-center md:text-right">
                        <p>&copy; 2025 Campus Connect | HIT Marketplace</p>
                        <p>All rights reserved</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
